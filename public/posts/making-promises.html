



<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Making Promises: KawDev</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <!-- Typekit -->
    <script type="text/javascript" src="//use.typekit.net/tlc4biu.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <!-- Styling and Profilin -->
    <link href="/kaw2k/public/assets/css/vendor/tomorrow.css" type="text/css" rel="stylesheet"  />
    <link href="/kaw2k/public/assets/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css"  />

    <!-- Modernizer -->
    <script src="/kaw2k/public/assets/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js" ></script>
</head>
<body onload="prettyPrint()">
<div class="container">



<section class="navigation">
    <div class="wrapper">
        
        <nav>
            <ul>
              <li >
                  <a class="active" href="/kaw2k/public/" >Posts</a>
              </li>
              <li >
                  <a  href="/kaw2k/public/about" >About</a>
              </li>
              <li class="logo">
                  <a  href="/kaw2k/public/" >kaw.dev</a>
              </li>
              <li >
                  <a  href="/kaw2k/public/projects" >Projects</a>
              </li>
              <li >
                  <a  href="https:&#x2F;&#x2F;github.com&#x2F;kaw2k">GitHub</a>
              </li>
            </ul>
        </nav>
    </div>
</section><!-- navigation -->



<section class="main">

    <section class="post">

        <hgroup>
            <h1>Making Promises</h1>
            <time>May 12, 2013</time>
        </hgroup>

        <p>Perhaps you have started using jQuery or NodeJS and realized callbacks can get a
bit unwieldy after a while. On the other hand, you may be a seasoned JS
developer who has used Promise libraries such as <a href="#">Q</a> before but want to
better understand what is going on under the hood. The goal for this post is to
learn how promises work by making a super simple Promise library which you can
use in your own projects. If you want to skip ahead, you can grab the final version of this code on <a href="https://github.com/kaw2k/Promise/blob/master/Promise.js">GitHub</a>.</p>
<p>To start this post, we will explore some code that could greatly benefit from
promises. The first example requires events to happen sequentially and the
second example simply needs all the events to finish before proceeding.</p>
<pre><code>// Sequential Events
// -----------------

// The asynchronous events
function auth(callback) {
    setTimeout(function () {
        callback(&#39;Authorized!&#39;);
    }, 1000);
}
function getData(callback) {
    setTimeout(function () {
        callback(&#39;Here is your data!&#39;);
    }, 1000);
}

// Run the events
auth(function (message) {
    console.log(message);
    getData(function (data) {
        console.log(data);
    });
});

// Parallel Events
// ---------------

// The asyncronouse events
function findUsers(callback) {
    setTimeout(function () {
        callback(&#39;Here are your users!&#39;);
    }, 1000);
}
function findRepos(callback) {
    setTimeout(function () {
        callback(&#39;Here are your repos!&#39;);
    }, 2000);
}

// The method to join events
var count = 0;
var data = [];
function join(value) {
    data.push(value);
    if (++count === 2) {
        console.log(data);
    }
}

// Run the events
findUsers(join);
findRepos(join);</code></pre>
<p>As you can see, each method of treating asynchronous events as sequential events
has its own ugliness. We can help alleviate these problems with Promises!</p>
<h2>Define the API</h2>
<p>Before jumping into code we need to define our API. We are going to keep things
fairly simply and only implement two public facing methods: <code>when</code> and <code>then</code>.</p>
<p><code>then</code> deals with sequential tasks, you can think of it as executing one task <em>then</em> executing another task.  On the other hand, <code>when</code> tackles parallel tasks. Again, <em>when</em> all these tasks are done <em>then</em> do this action. You are actually using <code>then</code> to solve parallel issues!</p>
<p>We will make a few other methods to help behind the scenes, for now we will
focus on what the end user will see.</p>
<h2>Setting Up the Bones</h2>
<pre><code>var Promise = (function () {
    var Promise = function() {};

    // ...

    return Promise;
})();

if (module) module.exports = Promise;</code></pre>
<h2>Class and Instance methods</h2>
<pre><code>// Class Methods
Promise.when = function () {};

// Instance Methods
Promise.prototype.then = function (onResolved, onRejected) {}
Promise.prototype.resolve = function (value) {}
Promise.prototype.reject = function (value) {}</code></pre>


    </section>
    
    <div class="post-navigation">
            <a class="previous" href="/kaw2k/public/posts&#x2F;fun-with-js" >&larr; Fun With RegExps and Functions</a>

    </div>

    
<hr />

<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'kawdev';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</section>

</div><!-- container -->
<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="/kaw2k/public/assets/js/vendor/jquery-1.8.3.min.js" ><\/script>')
</script>

<!-- Press 'g' to show a debugging grid -->
<script src="/kaw2k/public//assets/js/vendor/hashgrid.js" ></script>

<!-- Prettify Dat Code -->
<script src="/kaw2k/public/assets/js/vendor/prettify/prettify.js" ></script>

<!-- Scripts -->
<script src="/kaw2k/public/assets/js/main.js" ></script>
<script> $('code, pre').addClass('prettyprint'); </script>


<!-- Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-28018916-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
</html>

